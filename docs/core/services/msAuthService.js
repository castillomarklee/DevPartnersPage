"use strict";app.service("MSAuthService",["$q","$localStorage","$rootScope","$http","MSAPI_CONFIG",function($q,$localStorage,$rootScope,$http,MSAPI_CONFIG){function getTKFromLocalStorage(){return angular.fromJson(localStorage.getItem("dpcrmmstk"))}this.init=function(){var deferred=$q.defer();return delete $localStorage.mstk,this.clientApp=new Msal.UserAgentApplication(MSAPI_CONFIG.clientId,null,function(errorDesc,token,error,tokenType){},{redirectUri:MSAPI_CONFIG.redirectUri}),this.clientApp.redirectUri&&(this.clientApp.redirectUri=MSAPI_CONFIG.redirectUri),deferred.resolve({success:!0}),deferred.promise},this.login=function(){var _this=this,deferred=$q.defer();return getTKFromLocalStorage()?deferred.resolve({success:!0}):(_this.tkWatcher=$rootScope.$watch(function(){return getTKFromLocalStorage()},function(newVal,oldVal){newVal&&(_this.accessToken=newVal,deferred.resolve({success:!0}),_this.tkWatcher())}),_this.clientApp.loginPopup(MSAPI_CONFIG.graphScopes).then(function(idToken){_this.clientApp.acquireTokenSilent(MSAPI_CONFIG.graphScopes).then(function(accessToken){_this.accessToken=accessToken,$localStorage.mstk=_this.accessToken,deferred.resolve({success:!0})},function(error){console.log(error),getTKFromLocalStorage()?(_this.tkWatcher&&_this.tkWatcher(),deferred.resolve({success:!0})):deferred.reject({success:!1,errorMessage:error})})},function(error){deferred.reject({success:!1,errorMessage:error})})),deferred.promise},this.getAccessToken=function(){return this.accessToken?this.accessToken:getTKFromLocalStorage()},this.release=function(){this.tkWatcher&&this.tkWatcher()}}]);